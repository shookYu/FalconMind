# NodeAgent æµ‹è¯•æ€»ç»“

> **æœ€åæ›´æ–°**: 2024-01-30

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **README.md** - NodeAgent æ€»ä½“è¯´æ˜
- **Doc/07_NodeAgent_Cluster_Design.md** - NodeAgent å’Œ Cluster Center è®¾è®¡


# NodeAgent æµ‹è¯•æ€»ç»“

## æµ‹è¯•å®Œæˆæ—¶é—´
2024-01-29

## æµ‹è¯•ç»“æœæ€»è§ˆ

### âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

| æµ‹è¯•é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| Telemetry ä¸Šè¡Œæµ | âœ… é€šè¿‡ | 3 æ¡æ¶ˆæ¯æˆåŠŸæ¥æ”¶ï¼ŒJSON æ ¼å¼ä¼˜åŒ– |
| åŒå‘é€šä¿¡å»ºç«‹ | âœ… é€šè¿‡ | Socket å¤ç”¨æˆåŠŸ |
| ä¸‹è¡Œæ¶ˆæ¯æ¥æ”¶ | âœ… é€šè¿‡ | Command/Mission æ¶ˆæ¯æ­£å¸¸æ¥æ”¶å’Œå¤„ç† |
| JSON åºåˆ—åŒ–/ä¼ è¾“ | âœ… é€šè¿‡ | å•è¡Œæ ¼å¼ï¼Œå®Œæ•´æ¶ˆæ¯ä¼ è¾“ |

## å·²éªŒè¯åŠŸèƒ½

### 1. ä¸Šè¡Œæ•°æ®æµï¼ˆSDK â†’ NodeAgent â†’ Cluster Centerï¼‰

**æµç¨‹**ï¼š
```
SDK TelemetryPublisher
  â†’ publish(TelemetryMessage)
    â†’ NodeAgent è®¢é˜…å›è°ƒ
      â†’ UplinkClient åºåˆ—åŒ–ä¸º JSONï¼ˆå•è¡Œæ ¼å¼ï¼‰
        â†’ TCP socket å‘é€
          â†’ Cluster Center Mock æ¥æ”¶å¹¶æ‰“å°
```

**æµ‹è¯•ç»“æœ**ï¼š
- âœ… è¿æ¥å»ºç«‹æˆåŠŸ
- âœ… æ¶ˆæ¯åºåˆ—åŒ–æ­£å¸¸
- âœ… æ¶ˆæ¯ä¼ è¾“å®Œæ•´
- âœ… æ¥æ”¶ç«¯æ­£ç¡®è§£æå’Œæ˜¾ç¤º

### 2. ä¸‹è¡Œæ•°æ®æµï¼ˆCluster Center â†’ NodeAgentï¼‰

**æµç¨‹**ï¼š
```
Cluster Center Mock
  â†’ send("CMD:...") æˆ– send("MISSION:...")
    â†’ TCP socket å‘é€
      â†’ DownlinkClient æ¥æ”¶çº¿ç¨‹
        â†’ è§£ææ¶ˆæ¯ç±»å‹
          â†’ è°ƒç”¨æ¶ˆæ¯å¤„ç†å™¨å›è°ƒ
```

**æµ‹è¯•ç»“æœ**ï¼š
- âœ… åŒå‘é€šä¿¡å»ºç«‹æˆåŠŸ
- âœ… ä¸‹è¡Œæ¶ˆæ¯æ¥æ”¶æ­£å¸¸
- âœ… æ¶ˆæ¯ç±»å‹è¯†åˆ«æ­£ç¡®ï¼ˆCommand/Missionï¼‰
- âœ… æ¶ˆæ¯å¤„ç†å™¨å›è°ƒæ­£å¸¸

## æµ‹è¯•æ•°æ®ç¤ºä¾‹

### ä¸Šè¡Œ Telemetry æ¶ˆæ¯
```json
{"uav_id":"uav0","timestamp_ns":1769685253634414066,"position":{"lat":39.9042000,"lon":116.4074000,"alt":100.00},"attitude":{"roll":0.100,"pitch":0.200,"yaw":1.570},"velocity":{"vx":5.000,"vy":0.000,"vz":0.000},"battery":{"percent":85.0,"voltage_mv":12600},"gps":{"fix_type":3,"num_sat":12},"link_quality":95.0,"flight_mode":"OFFBOARD"}
```

### ä¸‹è¡Œ Command æ¶ˆæ¯
```
CMD:{"type":"ARM","uavId":"uav0"}
```

### ä¸‹è¡Œ Mission æ¶ˆæ¯
```
MISSION:{"id":"mission1","task":"takeoff_and_hover"}
```

## æ€§èƒ½æŒ‡æ ‡

- **è¿æ¥å»ºç«‹æ—¶é—´**ï¼š< 1 ç§’
- **æ¶ˆæ¯å‘é€å»¶è¿Ÿ**ï¼š< 10msï¼ˆæœ¬åœ°å›ç¯ï¼‰
- **æ¶ˆæ¯æ¥æ”¶ç‡**ï¼š100%
- **åŒå‘é€šä¿¡å»¶è¿Ÿ**ï¼š< 50msï¼ˆåŒ…æ‹¬åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼‰

## ä»£ç è´¨é‡

- âœ… æ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡
- âœ… æ— å†…å­˜æ³„æ¼ï¼ˆç®€å•æµ‹è¯•ï¼‰
- âœ… çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨ mutex ä¿æŠ¤ï¼‰
- âœ… é”™è¯¯å¤„ç†å®Œå–„

## å·²çŸ¥é™åˆ¶

1. **å½“å‰å®ç°**ï¼š
   - ä½¿ç”¨ TCP/JSONï¼Œé€‚åˆå¼€å‘å’Œæµ‹è¯•
   - å•æœºæµ‹è¯•ï¼ŒæœªéªŒè¯å¤š UAV åœºæ™¯
   - æ¶ˆæ¯è§£æè¾ƒç®€å•ï¼ˆå‰ç¼€åŒ¹é…ï¼‰

2. **åç»­æ”¹è¿›æ–¹å‘**ï¼š
   - åè®®å‡çº§åˆ° MQTTï¼ˆå‚è€ƒ `docs/Protocol_Upgrade_Plan.md`ï¼‰
   - å®Œå–„ JSON è§£æï¼ˆä½¿ç”¨ JSON åº“ï¼‰
   - æ·»åŠ æ¶ˆæ¯ç¡®è®¤æœºåˆ¶
   - æ”¯æŒå¤š UAV è¿æ¥ç®¡ç†

## æµ‹è¯•æ–‡ä»¶

- `test_telemetry_flow`ï¼šTelemetry ä¸Šè¡Œæµæµ‹è¯•
- `test_downlink_demo`ï¼šä¸‹è¡Œæ¶ˆæ¯æ¥æ”¶æµ‹è¯•
- `cluster_center_mock`ï¼šCluster Center æ¨¡æ‹ŸæœåŠ¡å™¨
- `demo/run_tests.sh`ï¼šæµ‹è¯•è„šæœ¬

## ç›¸å…³æ–‡æ¡£

- `TEST_REPORT.md`ï¼šè¯¦ç»†æµ‹è¯•æŠ¥å‘Š
- `OPTIMIZATION_LOG.md`ï¼šJSON æ¥æ”¶é€»è¾‘ä¼˜åŒ–æ—¥å¿—
- `docs/Protocol_Upgrade_Plan.md`ï¼šåè®®å‡çº§è®¡åˆ’
- `README.md`ï¼šä½¿ç”¨è¯´æ˜

## ç»“è®º

**NodeAgent æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨éªŒè¯é€šè¿‡**ï¼ŒåŒ…æ‹¬ï¼š
- âœ… ä¸Šè¡Œ Telemetry ä¸ŠæŠ¥
- âœ… ä¸‹è¡Œ Command/Mission æ¥æ”¶
- âœ… åŒå‘é€šä¿¡
- âœ… JSON åºåˆ—åŒ–/ååºåˆ—åŒ–

**ç³»ç»Ÿå·²å…·å¤‡åŸºæœ¬å¯ç”¨æ€§**ï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šç»§ç»­å¼€å‘ï¼š
- å®Œå–„ä¸‹è¡Œæ¶ˆæ¯å¤„ç†é€»è¾‘ï¼ˆè½¬æ¢ä¸º SDK å‘½ä»¤/ä»»åŠ¡ï¼‰
- åè®®å‡çº§ï¼ˆMQTT/gRPCï¼‰
- å¤š UAV æ”¯æŒ
- æ¶ˆæ¯ç¡®è®¤å’Œé‡ä¼ æœºåˆ¶
