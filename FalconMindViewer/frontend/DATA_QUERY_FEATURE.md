# 数据查询功能实现说明

## 功能概述

在界面中添加了数据库数据查看功能，用户可以通过工具栏菜单打开数据查询面板，查询和查看历史数据。

## 功能特性

### 1. 数据查询面板

**位置**: 工具栏 → 工具 → 数据查询

**功能**:
- 模态对话框形式，居中显示
- 三个标签页：遥测历史、系统事件、统计信息
- 响应式设计，适配不同屏幕尺寸

### 2. 遥测历史查询

**查询条件**:
- UAV ID（必填）
- 起始时间（可选）
- 结束时间（可选）
- 记录数限制（默认1000，最大10000）

**显示内容**:
- 时间戳
- 位置（经纬度）
- 高度
- 电池百分比
- GPS状态（Fix类型、卫星数）
- 飞行模式

**特点**:
- 表格形式展示
- 最多显示100条记录（可配置）
- 支持时间范围筛选

### 3. 系统事件查询

**查询条件**:
- 事件类型（可选，如：LOW_BATTERY）
- 严重程度（可选：INFO、WARNING、ERROR、CRITICAL）
- 记录数限制（默认100，最大1000）

**显示内容**:
- 时间戳
- 事件类型
- 严重程度（颜色编码）
- 消息内容
- 关联的UAV ID

**特点**:
- 严重程度用不同颜色显示
- 支持按类型和严重程度筛选

### 4. 统计信息

**显示内容**:
- 遥测记录数
- 任务记录数
- 系统事件数
- 数据库文件大小

**特点**:
- 卡片式展示
- 自动刷新
- 文件大小自动格式化（B/KB/MB）

## 使用方法

### 打开数据查询面板

1. 点击工具栏上的"工具"菜单
2. 选择"数据查询"
3. 或使用快捷键（如果配置）

### 查询遥测历史

1. 切换到"遥测历史"标签页
2. 输入UAV ID（必填）
3. 可选：选择时间范围
4. 可选：设置记录数限制
5. 点击"查询"按钮

### 查询系统事件

1. 切换到"系统事件"标签页
2. 可选：输入事件类型
3. 可选：选择严重程度
4. 可选：设置记录数限制
5. 点击"查询"按钮

### 查看统计信息

1. 切换到"统计信息"标签页
2. 自动显示统计信息
3. 点击"刷新统计信息"按钮更新

### 关闭面板

- 点击右上角的"✕"按钮
- 按ESC键
- 点击面板外部（如果实现）

## API接口

### 查询遥测历史

```
GET /api/v1/history/telemetry/history
参数:
  - uav_id: UAV ID（必填）
  - from_timestamp_ns: 起始时间戳（纳秒，可选）
  - to_timestamp_ns: 结束时间戳（纳秒，可选）
  - limit: 记录数限制（默认1000，最大10000）
```

### 查询系统事件

```
GET /api/v1/history/system/events
参数:
  - event_type: 事件类型（可选）
  - severity: 严重程度（可选）
  - limit: 记录数限制（默认100，最大1000）
```

### 获取统计信息

```
GET /api/v1/history/database/stats
```

## 界面设计

### 颜色方案

- 背景：深色主题（rgba(20, 25, 40, 0.98)）
- 文字：浅色（#cfd7ff）
- 标签：蓝色（#9fb4ff）
- 边框：半透明蓝色（rgba(159, 180, 255, 0.3)）

### 严重程度颜色

- INFO: #9fb4ff（蓝色）
- WARNING: #ffd93d（黄色）
- ERROR: #ff6b6b（红色）
- CRITICAL: #ff3838（深红色）

## 响应式设计

### 桌面端

- 完整显示所有功能
- 表格完整展示
- 多列布局

### 移动端

- 单列布局
- 字体缩小
- 表格横向滚动
- 按钮全宽

## 文件结构

```
frontend/
├── components/
│   └── data-query-panel.js  # 数据查询面板组件 ✨新增
├── app.js                   # 集成到工具栏菜单
├── styles.css               # 样式定义
└── index.html               # 加载组件
```

## 未来扩展

可以添加的功能：

1. **数据导出**
   - 导出为CSV
   - 导出为JSON
   - 导出为Excel

2. **图表展示**
   - 遥测数据趋势图
   - 事件统计图表
   - 时间序列分析

3. **高级筛选**
   - 多UAV查询
   - 自定义字段筛选
   - 保存查询条件

4. **数据可视化**
   - 在地图上显示历史轨迹
   - 热力图
   - 3D轨迹回放

5. **批量操作**
   - 批量删除
   - 批量导出
   - 数据清理

## 技术实现

### 组件架构

```
DataQueryPanel
  ├── create() - 创建面板
  ├── createTabs() - 创建标签页
  ├── switchTab() - 切换标签页
  ├── createTelemetryForm() - 遥测查询表单
  ├── createEventsForm() - 事件查询表单
  ├── createStatsForm() - 统计信息表单
  ├── queryTelemetry() - 查询遥测数据
  ├── queryEvents() - 查询系统事件
  ├── queryStats() - 查询统计信息
  ├── displayTelemetryResults() - 显示遥测结果
  ├── displayEventsResults() - 显示事件结果
  ├── displayStatsResults() - 显示统计结果
  ├── open() - 打开面板
  ├── close() - 关闭面板
  └── toggle() - 切换显示
```

### 数据流

1. 用户填写查询表单
2. 点击查询按钮
3. 发送API请求
4. 接收响应数据
5. 格式化并显示结果

## 注意事项

1. **性能考虑**
   - 限制返回记录数
   - 分页显示（未来实现）
   - 异步加载

2. **错误处理**
   - 网络错误提示
   - 数据验证
   - 友好的错误消息

3. **用户体验**
   - 加载状态提示
   - 空数据提示
   - 操作反馈
